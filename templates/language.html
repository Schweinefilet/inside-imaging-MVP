<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>Magazine Viewer - Inside Imaging</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">

  <script>
  (function(){
    try{
      var t = localStorage.getItem('theme');
      var preferLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var useLight = t ? (t === 'light') : preferLight;
      if (useLight) document.documentElement.classList.add('light');
    }catch(e){}
  })();
  </script>

  <link rel="stylesheet" href="/static/main.css">
  <link rel="stylesheet" href="/static/dashboard.css">
  <link rel="stylesheet" href="/static/magazine.css">
</head>
<body>
  <div class="page-wrapper">
    <header class="navbar">
      <div class="navbar-brand">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Inside Imaging Logo" class="logo">
      </div>
      <nav class="nav-links">
        <a href="{{ url_for('index') }}">Dashboard</a>
        <a href="{{ url_for('projects') }}" class="active">Projects</a>
        <a href="{{ url_for('report_status') }}">Statistics</a>
        <a href="{{ url_for('payment') }}">Payment</a>
        <a href="{{ url_for('help_page') }}">Help</a>
      </nav>
      <div class="nav-auth">
        <label class="theme-switch" aria-label="Toggle theme">
          <span class="theme-row">
            <span class="theme-icon" aria-hidden="true">üåô</span>
            <input id="theme-toggle" class="theme-switch-input" type="checkbox" role="switch" aria-checked="false">
            <span class="theme-switch-track" aria-hidden="true"></span>
            <span class="theme-icon" aria-hidden="true">‚òÄÔ∏è</span>
          </span>
          <span id="theme-label" class="theme-switch-text">Dark mode</span>
        </label>
          {% if session.get('username') %}
          <div class="user-menu">
            <button class="user-menu-toggle" type="button" aria-expanded="false">
              <span class="user-name" aria-live="polite">{{ session.get('username') }}</span>
              <span class="user-caret" aria-hidden="true">‚ñæ</span>
            </button>
            <div class="user-menu-dropdown" role="menu" hidden>
              <a href="{{ url_for('profile') }}" role="menuitem">Profile</a>
              <a href="{{ url_for('logout') }}" role="menuitem">Log Out</a>
            </div>
          </div>
          {% else %}
          <a href="{{ url_for('login') }}" class="login-button">Log In</a>
          <a href="{{ url_for('signup') }}" class="signup-button">Sign Up</a>
          {% endif %}
      </div>
    </header>

    <main class="content magazine-page">
      <section class="magazine-hero">
        <h1>Inside Imaging Magazine</h1>
        <p>Explore our curated bimonthly magazine featuring in-depth articles, patient success stories, and radiologist insights tailored for patients and clinicians alike.</p>
      </section>

      <section class="magazine-toolbar" aria-label="Magazine controls">
        {% if magazine_url %}
        <a href="{{ magazine_url }}" target="_blank" rel="noopener" aria-label="Open magazine in new tab">Open in new tab</a>
        <a href="{{ magazine_url }}" download aria-label="Download PDF">Download issue</a>
        {% else %}
        <span style="color: var(--muted);">The latest issue will appear here soon.</span>
        {% endif %}
      </section>

      {% if magazine_url %}
      <section class="magazine-frame" aria-label="Magazine PDF viewer">
        <div id="magazine-loader" class="magazine-loader" role="status" aria-live="polite">
          <div class="loader-one">
            <div class="loader-orb"></div>
            <div class="loader-tail"></div>
            <span class="loader-copy">Loading magazine‚Ä¶</span>
          </div>
        </div>
        <iframe src="{{ magazine_url }}#toolbar=0" title="Inside Imaging Magazine PDF"></iframe>
      </section>
      {% else %}
      <section class="magazine-placeholder">
        <h2>No issue uploaded yet</h2>
        <p>Upload `static/magazine/latest.pdf` to publish the newest Inside Imaging Magazine issue. Your readers will see it instantly here.</p>
      </section>
      {% endif %}

      <section class="magazine-history">
        <h2>Recent Editions</h2>
        <p>Highlighting topics from recent issues. Add archives to `static/magazine/` and list them here for quick access.</p>
        <ul>
          {% for item in archive %}
          <li>
            <strong>{{ item.title }}</strong>
            {% if item.url %}
            <a href="{{ item.url }}" target="_blank" rel="noopener">View</a>
            {% else %}
            <span>{{ item.note }}</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </section>
    </main>

    {% include '_footer.html' %}
  </div>

  <script src="/static/theme.js"></script>
  <script>
  (function(){
    var frame = document.querySelector('.magazine-frame iframe');
    var loader = document.getElementById('magazine-loader');
    if (!frame || !loader) return;
    loader.classList.add('is-active');
    var hide = function(){ loader.classList.remove('is-active'); loader.classList.add('is-hidden'); };
    frame.addEventListener('load', hide, { once: true });
  })();
  </script>
</body>
</html>
