<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>Statistics - Inside Imaging</title>

  <!-- Pre-paint: identical to working pages -->
  <script>
  (function(){
    try {
      var t = localStorage.getItem('theme');
      var preferLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var useLight = t ? (t === 'light') : preferLight;
      if (useLight) document.documentElement.classList.add('light');
    } catch(e){}
  })();
  </script>

  <link rel="stylesheet" href="/static/main.css">
  <link rel="stylesheet" href="/static/dashboard.css">
  <link rel="stylesheet" href="/static/report-status.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Navigation Bar -->
    <header class="navbar">
      <div class="navbar-brand">
  <img src="{{ url_for('static', filename='logo.png') }}" alt="Inside Imaging logo" class="logo">
      </div>

      <nav class="nav-links">
        <a href="{{ url_for('index') }}">Dashboard</a>
        <a href="{{ url_for('projects') }}">Projects</a>
        <a href="{{ url_for('projects') }}#insights">Insights</a>
        <a href="{{ url_for('report_status') }}" class="active">Statistics</a>
        <a href="{{ url_for('payment') }}">Payment</a>
        <a href="{{ url_for('help_page') }}">Help</a>
      </nav>

      <div class="nav-auth">
        <label class="theme-switch" aria-label="Toggle theme">
          <span class="theme-row">
            <span class="theme-icon" aria-hidden="true">üåô</span>
            <input id="theme-toggle" class="theme-switch-input" type="checkbox" role="switch" aria-checked="false">
            <span class="theme-switch-track" aria-hidden="true"></span>
            <span class="theme-icon" aria-hidden="true">‚òÄÔ∏è</span>
          </span>
          <span id="theme-label" class="theme-switch-text">Dark mode</span>
        </label>

        {% if session.get('username') %}
        <div class="user-menu">
          <button class="user-menu-toggle" type="button" aria-expanded="false">
            <span class="user-name" aria-live="polite">{{ session.get('username') }}</span>
            <span class="user-caret" aria-hidden="true">‚ñæ</span>
          </button>
          <div class="user-menu-dropdown" role="menu" hidden>
            <a href="{{ url_for('profile') }}" role="menuitem">Profile</a>
            <a href="{{ url_for('logout') }}" role="menuitem">Log Out</a>
          </div>
        </div>
        {% else %}
        <a href="{{ url_for('login') }}" class="login-button">Log In</a>
        <a href="{{ url_for('signup') }}" class="signup-button">Sign Up</a>
        {% endif %}
      </div>
    </header>

    <main class="content analytics">
      <header class="analytics-header">
        <h1>Platform Statistics</h1>
        <p class="tagline">Aggregated engagement metrics from de-identified report summaries.</p>
      </header>

      <section class="analytics-summary" aria-label="Summary metrics">
        <article class="summary-card">
          <p class="summary-label">Total Reports Parsed</p>
          <p class="summary-value">{{ stats.summary.total_reports }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Reports in Last 30 Days</p>
          <p class="summary-value">{{ stats.summary.last_30_days }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Average Word Count</p>
          <p class="summary-value">{{ stats.summary.average_word_count }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Languages Logged</p>
          <p class="summary-value">{{ stats.summary.languages_tracked }}</p>
        </article>
      </section>

      <section class="analytics-grid">
        <article class="analytics-panel">
          <h2>Age Distribution</h2>
          <ul class="stat-list">
            {% for label, count in stats.age_ranges.items() %}
            <li><span>{{ label }}</span><span>{{ count }}</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Gender Mix</h2>
          <ul class="stat-list">
            <li><span>Female</span><span>{{ stats.gender.female }}</span></li>
            <li><span>Male</span><span>{{ stats.gender.male }}</span></li>
            <li><span>Other</span><span>{{ stats.gender.other }}</span></li>
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Languages</h2>
          <ul class="stat-list">
            {% for entry in stats.languages %}
            <li><span>{{ entry.label }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Modalities</h2>
          <ul class="stat-list">
            {% for entry in stats.studies %}
            <li><span>{{ entry.label }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel span-2">
          <h2>Top Findings</h2>
          <ul class="stat-list">
            {% for entry in stats.diseases %}
            <li><span>{{ entry.label|capitalize }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel span-2">
          <h2>Recent Activity</h2>
          <ul class="recent-list">
            {% for item in stats.recent %}
            <li>
              <div class="recent-head">
                <div class="recent-primary">
                  <strong>{{ item.study }}</strong>
                  <span class="recent-language">{{ item.language or '‚Äî' }}</span>
                </div>
                <span class="recent-time">{{ item.created_at }}</span>
              </div>
              {% if item.disease_tags %}
              <div class="recent-tags">{{ item.disease_tags | join(', ') }}</div>
              {% endif %}
              <a class="recent-link" href="{{ url_for('report_detail', report_id=item.id) }}">View report ‚Üí</a>
            </li>
            {% else %}
            <li>No reports logged yet.</li>
            {% endfor %}
          </ul>
        </article>
      </section>
    </main>

    {% include '_footer.html' %}
  </div>

  <!-- Shared theme logic; no page-local theme code -->
  <script src="/static/theme.js"></script>
</body>
</html>
