<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>Inside Imaging</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">
  
  <!-- Pre-paint: prevent flash on load -->
  <script>
  (function(){
    try {
      var t = localStorage.getItem('theme');
      var preferLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var useLight = t ? (t === 'light') : preferLight;
      if (useLight) {
        document.documentElement.classList.add('light');
      }
    } catch(e){}
  })();
  </script>
  
  <link rel="stylesheet" href="/static/main.css">
  <link rel="stylesheet" href="/static/dashboard.css">
  <link rel="stylesheet" href="/static/loader.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='landing.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='compare.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='testimonials.css') }}">
  
  <style>
    /* Flash message styles */
    #flash-container {
      position: fixed;
      top: 96px;
      right: 24px;
      z-index: 10000;
      width: min(90vw, 360px);
      display: grid;
      gap: 0.75rem;
    }
    .flash-message {
      color: #ffffff;
      padding: 0.9rem 1.2rem;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(9, 10, 13, 0.35);
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      line-height: 1.45;
      animation: flashSlideIn 0.25s ease forwards;
      border: 1px solid rgba(255, 255, 255, 0.18);
      backdrop-filter: blur(6px);
    }
    .flash-message strong {
      font-size: 0.95rem;
      display: block;
      margin-bottom: 0.2rem;
    }
    .flash-body {
      flex: 1 1 auto;
      min-width: 0;
    }
    .flash-body span {
      display: block;
      font-size: 0.85rem;
      word-break: break-word;
    }
    .flash-error {
      background: rgba(220, 38, 38, 0.92);
    }
    .flash-success {
      background: rgba(34, 197, 94, 0.92);
    }
    .flash-close {
      background: none;
      border: none;
      color: inherit;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      opacity: 0.8;
      transition: opacity 0.2s ease;
    }
    .flash-close:hover,
    .flash-close:focus-visible {
      opacity: 1;
    }
    @keyframes flashSlideIn {
      from {
        transform: translateY(-12px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    @media (max-width: 640px) {
      #flash-container {
        top: 72px;
        right: 16px;
        left: 16px;
        width: auto;
      }
    }
  </style>
</head>
<body>
  {% set landing_text = "INSIDE IMAGING" %}
  <div id="landing-overlay" class="landing-overlay landing-hidden" role="dialog" aria-modal="true" aria-label="Inside Imaging introduction" aria-hidden="true" tabindex="-1">
    <div class="landing-inner">
      <div class="landing-heading" aria-hidden="true">
        {% for char in landing_text %}
          {% if char == ' ' %}
            <span class="spacer" data-char=" "></span>
          {% else %}
            <span data-char="{{ char }}">{{ char }}</span>
          {% endif %}
        {% endfor %}
      </div>
      <p class="landing-tagline">Plain-language radiology reports with immersive visuals and guidance tailored for patients.</p>
      <button type="button" class="landing-continue" id="landing-continue">Continue</button>
    </div>
  </div>
  <div class="page-wrapper">
    <header class="navbar">
      <div class="navbar-brand">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Inside Imaging Logo" class="logo">
      </div>
      <nav class="nav-links">
        <a href="{{ url_for('index') }}">Dashboard</a>
        <a href="{{ url_for('projects') }}">Projects</a>
        <a href="{{ url_for('report_status') }}">Statistics</a>
        <a href="{{ url_for('payment') }}">Payment</a>
        <a href="{{ url_for('help_page') }}">Help</a>
      </nav>
      <div class="nav-auth">

<!-- Slider toggle (replaces the old button) -->
<label class="theme-switch" aria-label="Toggle theme">
    <span class="theme-row">
        <span class="theme-icon" aria-hidden="true">üåô</span>
        <input id="theme-toggle" class="theme-switch-input" type="checkbox" role="switch" aria-checked="false">
        <span class="theme-switch-track" aria-hidden="true"></span>
        <span class="theme-icon" aria-hidden="true">‚òÄÔ∏è</span>
    </span>
    <span id="theme-label" class="theme-switch-text">Dark mode</span>
</label>
<script>
(function(){
  var toggle = document.getElementById('theme-toggle');
  if (!toggle) return;
  var isLight = document.documentElement.classList.contains('light');
  toggle.checked = isLight;
  toggle.setAttribute('aria-checked', isLight ? 'true' : 'false');
})();
</script>

        {% if session.get('username') %}
        <div class="user-menu">
          <button class="user-menu-toggle" type="button" aria-expanded="false">
            <span class="user-name" aria-live="polite">{{ session.get('username') }}</span>
            <span class="user-caret" aria-hidden="true">‚ñæ</span>
          </button>
          <div class="user-menu-dropdown" role="menu" hidden>
            <a href="{{ url_for('profile') }}" role="menuitem">Profile</a>
            <a href="{{ url_for('logout') }}" role="menuitem">Log Out</a>
          </div>
        </div>
        {% else %}
        <a href="{{ url_for('login') }}" class="login-button">Log In</a>
        <a href="{{ url_for('signup') }}" class="signup-button">Sign Up</a>
        {% endif %}
      </div>
    </header>

    <!-- Flash Messages Popup -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div id="flash-container">
          {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}" role="status" aria-live="assertive">
              <div class="flash-body">
                <strong>{% if category == 'error' %}‚ùå Upload Rejected{% else %}‚úì Success{% endif %}</strong>
                <span>{{ message }}</span>
              </div>
              <button type="button" onclick="this.parentElement.remove()" class="flash-close" aria-label="Dismiss notification">√ó</button>
            </div>
          {% endfor %}
        </div>
        <script>
          // Auto-dismiss flash messages after 8 seconds
          setTimeout(function() {
            var container = document.getElementById('flash-container');
            if (container) {
              container.style.animation = 'slideOut 0.3s ease';
              setTimeout(function() { container.remove(); }, 300);
            }
          }, 8000);
        </script>
      {% endif %}
    {% endwith %}

    <main class="content">
      <h1>Dashboard</h1>
      <p>Upload, manage, and download your translated radiology reports in one place.</p>

      <div class="dashboard-grid">
        <div class="dashboard-left">
          <section class="upload-section">
            <h2>Upload New Report</h2>
            <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" class="upload-form">
              <input type="file" name="file" accept=".pdf,.txt" required>
              <label for="language">Language:</label>
              <select name="language" id="language">
                {% for language in languages %}
                <option value="{{ language }}">{{ language }}</option>
                {% endfor %}
              </select>
              <button type="submit">Upload &amp; Convert</button>
            </form>
          </section>

          <section class="transformation-section">
            <h2>See the Transformation</h2>
            <p class="transformation-subtitle">Compare raw medical phrasing with patient-friendly wording.</p>
            <div class="compare-container-compact" data-mode="drag">
              <div class="compare-wrapper-compact">
                <img 
                  src="{{ url_for('static', filename='after-report.png') }}" 
                  alt="Simplified patient-friendly report after translation" 
                  class="compare-image first"
                />
                <img 
                  src="{{ url_for('static', filename='before-report.png') }}" 
                  alt="Complex medical report before translation" 
                  class="compare-image second"
                />
                <div class="compare-slider">
                  <div class="compare-handle"></div>
                </div>
                <span class="compare-label before">Before</span>
                <span class="compare-label after">After</span>
              </div>
              <p class="compare-description-compact">
                Drag to compare medical jargon vs plain language.
              </p>
            </div>
          </section>
        </div>

        <section class="reports-section">
          <header class="reports-section-header">
            <h2>Your Reports</h2>
            {% if session.get('username') %}
            <p>Your saved reports across all sessions.</p>
            {% else %}
            <p>Revisit the reports you generated during this session. <a href="{{ url_for('login') }}" style="color: var(--mint);">Log in</a> to save reports permanently.</p>
            {% endif %}
          </header>

          <ul class="reports-history">
            {% if session.get('username') and user_reports %}
              {% for item in user_reports %}
              <li class="history-item">
                <div class="history-info">
                  <div class="history-primary">
                    <strong>{{ item.study }}</strong>
                    <span class="history-language">{{ item.language or 'English' }}</span>
                  </div>
                  <div class="history-meta">
                    <span>{{ item.patient_name }} ‚Ä¢ {{ item.created_at or 'Just now' }}</span>
                  </div>
                  {% if item.disease_tags %}
                  <div class="history-tags">
                    {% for tag in item.disease_tags %}
                    <span>{{ tag }}</span>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
                <a class="history-link" href="{{ url_for('report_detail', report_id=item.id) }}">View report ‚Üí</a>
              </li>
              {% endfor %}
            {% elif recent_reports %}
              {% for item in recent_reports %}
              <li class="history-item">
                <div class="history-info">
                  <div class="history-primary">
                    <strong>{{ item.study }}</strong>
                    <span class="history-language">{{ item.language or 'English' }}</span>
                  </div>
                  <div class="history-meta">
                    <span>{{ item.created_at or 'Just now' }}</span>
                  </div>
                  {% if item.disease_tags %}
                  <div class="history-tags">
                    {% for tag in item.disease_tags %}
                    <span>{{ tag }}</span>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
                <a class="history-link" href="{{ url_for('report_detail', report_id=item.id) }}">View report ‚Üí</a>
              </li>
              {% endfor %}
            {% else %}
              <li class="history-item empty">
                <p>No reports yet. Upload a file to see your history here.</p>
              </li>
            {% endif %}
          </ul>

          {% set total_reports = stats.summary.total_reports or 0 %}
          <section class="reports-insights" aria-label="Platform insights">
            <h3>Platform Insights</h3>
            <div class="insight-cards">
              <article class="insight-card">
                <span class="insight-icon" aria-hidden="true">üìÑ</span>
                <span class="insight-label">Reports Parsed</span>
                <span class="insight-value">{{ stats.summary.total_reports }}</span>
              </article>
              <article class="insight-card">
                <span class="insight-icon" aria-hidden="true">üóìÔ∏è</span>
                <span class="insight-label">Reports (30 Days)</span>
                <span class="insight-value">{{ stats.summary.last_30_days }}</span>
              </article>
              <article class="insight-card">
                <span class="insight-icon" aria-hidden="true">üìù</span>
                <span class="insight-label">Avg. Word Count</span>
                <span class="insight-value">{{ stats.summary.average_word_count }}</span>
              </article>
              <article class="insight-card">
                <span class="insight-icon" aria-hidden="true">üåç</span>
                <span class="insight-label">Languages Logged</span>
                <span class="insight-value">{{ stats.summary.languages_tracked }}</span>
              </article>
            </div>

            <div class="insight-columns">
              <div class="insight-column">
                <h4>Age Distribution</h4>
                <ul class="insight-list">
                  {% for label, count in stats.age_ranges.items() %}
                  {% set percent = ((count / total_reports) * 100)|round(1) if total_reports else 0 %}
                  <li>
                    <div class="insight-row">
                      <span class="insight-name">{{ label }}</span>
                      <span class="insight-count">{{ count }}</span>
                    </div>
                    <div class="insight-bar" data-progress="{{ percent }}">
                      <span class="insight-progress"></span>
                    </div>
                  </li>
                  {% endfor %}
                </ul>
              </div>
              <div class="insight-column">
                <h4>Gender Mix</h4>
                <ul class="insight-list">
                  {% for label, count in {'Female': stats.gender.female, 'Male': stats.gender.male, 'Other': stats.gender.other}.items() %}
                  {% set percent = ((count / total_reports) * 100)|round(1) if total_reports else 0 %}
                  <li>
                    <div class="insight-row">
                      <span class="insight-name">{{ label }}</span>
                      <span class="insight-count">{{ count }}</span>
                    </div>
                    <div class="insight-bar" data-progress="{{ percent }}">
                      <span class="insight-progress"></span>
                    </div>
                  </li>
                  {% endfor %}
                </ul>
              </div>
              <div class="insight-column">
                <h4>Top Findings</h4>
                <ul class="insight-list">
                  {% for item in stats.diseases[:4] %}
                  {% set percent = ((item.count / total_reports) * 100)|round(1) if total_reports else 0 %}
                  <li>
                    <div class="insight-row">
                      <span class="insight-name">{{ item.label }}</span>
                      <span class="insight-count">{{ item.count }}</span>
                    </div>
                    <div class="insight-bar" data-progress="{{ percent }}">
                      <span class="insight-progress"></span>
                    </div>
                  </li>
                  {% else %}
                  <li class="insight-empty">No findings yet.</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </section>
        </section>
      </div>

      <!-- Animated Testimonials Section -->
      <section class="testimonials-section">
        <div class="testimonials-header">
          <h2>Trusted by Healthcare Professionals</h2>
          <p>Hear what doctors and radiologists say about Inside Imaging</p>
        </div>

        <div class="testimonials-container">
          <div class="testimonial-card">
            <p class="testimonial-quote">
              "This platform has transformed how we communicate complex medical information to our patients. [Testimonial pending pilot program completion]"
            </p>
            <div class="testimonial-author">
              <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--panel); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--muted);">üë§</div>
              <div class="testimonial-info">
                <p class="testimonial-name">Healthcare Professional</p>
                <p class="testimonial-title">Pilot Program Participant</p>
              </div>
            </div>
          </div>

          <div class="testimonial-card">
            <p class="testimonial-quote">
              "The multilingual support makes a real difference in our diverse patient community. [Feedback from pilot program to be added here]"
            </p>
            <div class="testimonial-author">
              <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--panel); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--muted);">üë§</div>
              <div class="testimonial-info">
                <p class="testimonial-name">Medical Professional</p>
                <p class="testimonial-title">Early Adopter</p>
              </div>
            </div>
          </div>

          <div class="testimonial-card">
            <p class="testimonial-quote">
              "Patients appreciate receiving their reports in plain language. [Real testimonials will be collected during pilot phase]"
            </p>
            <div class="testimonial-author">
              <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--panel); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--muted);">üë§</div>
              <div class="testimonial-info">
                <p class="testimonial-name">Radiology Partner</p>
                <p class="testimonial-title">Testing Phase</p>
              </div>
            </div>
          </div>

          <div class="testimonial-card">
            <p class="testimonial-quote">
              "We're excited to be part of this innovative approach to patient care. [Testimonial content pending]"
            </p>
            <div class="testimonial-author">
              <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--panel); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--muted);">üë§</div>
              <div class="testimonial-info">
                <p class="testimonial-name">Clinical Partner</p>
                <p class="testimonial-title">Pilot Participant</p>
              </div>
            </div>
          </div>

          <div class="testimonial-card">
            <p class="testimonial-quote">
              "Early results show promise for improving patient understanding. [Full review coming after pilot completion]"
            </p>
            <div class="testimonial-author">
              <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--panel); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--muted);">üë§</div>
              <div class="testimonial-info">
                <p class="testimonial-name">Healthcare Provider</p>
                <p class="testimonial-title">Pilot Program</p>
              </div>
            </div>
          </div>
        </div>

        <div class="testimonials-nav">
          <button class="testimonial-nav-btn prev" aria-label="Previous testimonial">‚Äπ</button>
          <div class="testimonials-dots">
            <span class="testimonial-dot active"></span>
            <span class="testimonial-dot"></span>
            <span class="testimonial-dot"></span>
            <span class="testimonial-dot"></span>
            <span class="testimonial-dot"></span>
          </div>
          <button class="testimonial-nav-btn next" aria-label="Next testimonial">‚Ä∫</button>
        </div>
      </section>
    </main>

    {% include '_footer.html' %}
  </div>

  <script src="{{ url_for('static', filename='theme.js') }}"></script>
  <script src="{{ url_for('static', filename='compare.js') }}"></script>
  <script src="{{ url_for('static', filename='testimonials.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.insight-bar').forEach(function(bar) {
    var span = bar.querySelector('.insight-progress');
    if (!span) return;
    var raw = parseFloat(bar.dataset.progress);
    var clamped = Number.isFinite(raw) ? Math.min(Math.max(raw, 0), 100) : 0;
    span.style.width = clamped + '%';
  });
});
</script>

<script>
(function(){
  var overlay = document.getElementById('landing-overlay');
  if (!overlay) return;
  var continueBtn = document.getElementById('landing-continue');
  
  // Check if user is navigating within site (has sessionStorage flag)
  var isInternalNav = sessionStorage.getItem('iiInternalNav') === '1';
  
  var disableOverlay = function(){
    overlay.classList.add('landing-hidden');
    overlay.setAttribute('aria-hidden', 'true');
    setTimeout(function(){ if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay); }, 650);
  };

  // Set flag to indicate user has navigated within site
  sessionStorage.setItem('iiInternalNav', '1');

  // Only show overlay if NOT internal navigation (i.e., fresh site entry)
  if (isInternalNav) {
    disableOverlay();
    return;
  }

  // Show intro overlay for fresh site entry
  requestAnimationFrame(function(){
    overlay.classList.remove('landing-hidden');
    overlay.setAttribute('aria-hidden', 'false');
    if (continueBtn) continueBtn.focus();
  });

  var updateGradient = function(evt){
    var rect = overlay.getBoundingClientRect();
    var x = ((evt.clientX - rect.left) / rect.width) * 100;
    var y = ((evt.clientY - rect.top) / rect.height) * 100;
    overlay.style.setProperty('--mx', x + '%');
    overlay.style.setProperty('--my', y + '%');
  };

  overlay.addEventListener('mousemove', updateGradient);
  overlay.addEventListener('touchmove', function(evt){
    if (!evt.touches || !evt.touches.length) return;
    updateGradient(evt.touches[0]);
  }, { passive: true });

  if (continueBtn) continueBtn.addEventListener('click', disableOverlay);
  overlay.addEventListener('click', function(evt){
    if (evt.target === overlay) disableOverlay();
  });
  overlay.addEventListener('keydown', function(evt){
    if (evt.key === 'Enter' || evt.key === ' ') {
      evt.preventDefault();
      disableOverlay();
    }
    if (evt.key === 'Escape') {
      disableOverlay();
    }
  });
})();
</script>

  <script src="/static/loader.js"></script>
</body>
</html>
