<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>Statistics - Inside Imaging</title>

  <!-- Pre-paint: identical to working pages -->
  <script>
  (function(){
    try {
      var t = localStorage.getItem('theme');
      var preferLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      var useLight = t ? (t === 'light') : preferLight;
      if (useLight) document.documentElement.classList.add('light');
    } catch(e){}
  })();
  </script>

  <link rel="stylesheet" href="/static/main.css">
  <link rel="stylesheet" href="/static/dashboard.css">
  <link rel="stylesheet" href="/static/report-status.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Navigation Bar -->
    <header class="navbar">
      <div class="navbar-brand">
  <img src="{{ url_for('static', filename='logo.png') }}" alt="Inside Imaging logo" class="logo">
      </div>

      <nav class="nav-links">
        <a href="{{ url_for('index') }}">Dashboard</a>
        <a href="{{ url_for('magazine') }}">Magazine Viewer</a>
        <a href="{{ url_for('report_status') }}" class="active">Statistics</a>
        <a href="{{ url_for('payment') }}">Payment</a>
        <a href="{{ url_for('blogs') }}">Radiologist Blogs</a>
        <a href="{{ url_for('help_page') }}">Help</a>
      </nav>

      <div class="nav-auth">
        <label class="theme-switch" aria-label="Toggle theme">
          <span class="theme-row">
            <span class="theme-icon" aria-hidden="true">üåô</span>
            <input id="theme-toggle" class="theme-switch-input" type="checkbox" role="switch" aria-checked="false">
            <span class="theme-switch-track" aria-hidden="true"></span>
            <span class="theme-icon" aria-hidden="true">‚òÄÔ∏è</span>
          </span>
          <span id="theme-label" class="theme-switch-text">Dark mode</span>
        </label>

        {% if session.get('username') %}
        <span class="username-badge" aria-live="polite">Signed in as {{ session.get('username') }}</span>
        <a href="{{ url_for('logout') }}" class="logout-button">Log Out</a>
        {% else %}
        <a href="{{ url_for('login') }}" class="login-button">Log In</a>
        <a href="{{ url_for('signup') }}" class="signup-button">Sign Up</a>
        {% endif %}
      </div>
    </header>

    <main class="content analytics">
      <header class="analytics-header">
        <h1>Platform Statistics</h1>
        <p class="tagline">Aggregated engagement metrics from de-identified report summaries.</p>
      </header>

      <section class="analytics-summary" aria-label="Summary metrics">
        <article class="summary-card">
          <p class="summary-label">Total Reports Parsed</p>
          <p class="summary-value">{{ stats.summary.total_reports }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Reports in Last 30 Days</p>
          <p class="summary-value">{{ stats.summary.last_30_days }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Average Word Count</p>
          <p class="summary-value">{{ stats.summary.average_word_count }}</p>
        </article>
        <article class="summary-card">
          <p class="summary-label">Languages Logged</p>
          <p class="summary-value">{{ stats.summary.languages_tracked }}</p>
        </article>
      </section>

      <section class="analytics-grid">
        <article class="analytics-panel">
          <h2>Age Distribution</h2>
          <ul class="stat-list">
            {% for label, count in stats.age_ranges.items() %}
            <li><span>{{ label }}</span><span>{{ count }}</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Gender Mix</h2>
          <ul class="stat-list">
            <li><span>Female</span><span>{{ stats.gender.female }}</span></li>
            <li><span>Male</span><span>{{ stats.gender.male }}</span></li>
            <li><span>Other</span><span>{{ stats.gender.other }}</span></li>
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Languages</h2>
          <ul class="stat-list">
            {% for entry in stats.languages %}
            <li><span>{{ entry.label }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel">
          <h2>Modalities</h2>
          <ul class="stat-list">
            {% for entry in stats.studies %}
            <li><span>{{ entry.label }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel span-2">
          <h2>Top Findings</h2>
          <ul class="stat-list">
            {% for entry in stats.diseases %}
            <li><span>{{ entry.label|capitalize }}</span><span>{{ entry.count }}</span></li>
            {% else %}
            <li><span>No data yet</span><span>0</span></li>
            {% endfor %}
          </ul>
        </article>
        <article class="analytics-panel span-2">
          <h2>Recent Activity</h2>
          <ul class="recent-list">
            {% for item in stats.recent %}
            <li>
              <div>
                <strong>{{ item.study }}</strong>
                <span class="recent-language">{{ item.language or '‚Äî' }}</span>
              </div>
              <div class="recent-meta">
                <span>{{ item.created_at }}</span>
                {% if item.disease_tags %}
                <span class="recent-tags">{{ item.disease_tags | join(', ') }}</span>
                {% endif %}
              </div>
            </li>
            {% else %}
            <li>No reports logged yet.</li>
            {% endfor %}
          </ul>
        </article>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-columns">
        <div class="footer-about">
          <h3>Inside Imaging</h3>
          <p>Transforming radiology reports into your preferred language with ease.</p>
        </div>
        <div class="footer-col">
          <h4>Navigation</h4>
          <ul>
            <li><a href="{{ url_for('index') }}">Dashboard</a></li>
             <li><a href="{{ url_for('magazine') }}">Magazine Viewer</a></li>
            <li><a href="{{ url_for('report_status') }}">Report Status</a></li>
            <li><a href="{{ url_for('payment') }}">Payment</a></li>
             <li><a href="{{ url_for('blogs') }}">Radiologist Blogs</a></li>
            <li><a href="{{ url_for('help_page') }}">Help</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Resources</h4>
          <ul>
            <li><a href="#">Documentation</a></li>
            <li><a href="#">Blog</a></li>
            <li><a href="#">Support</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Connect</h4>
          <ul>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">LinkedIn</a></li>
            <li><a href="#">Contact</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© <span id="current-year"></span> Inside Imaging. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <!-- Shared theme logic; no page-local theme code -->
  <script src="/static/theme.js"></script>
  <script>
    var y = document.getElementById('current-year');
    if (y) y.textContent = new Date().getFullYear();
  </script>
</body>
</html>
